<!DOCTYPE html>
<html lang="zh-CN">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Day8_ElectronicAlbum - 空白Koobai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="/suju/ios.json">
  <link rel="icon" href="https://img.koobai.com/koobai.png">
  <link href="/index.xml" title="空白Koobai" type="application/rss+xml">
  <link rel="canonical" href="http://localhost:1313/day8_electronicalbum/" />

  
  
  <link rel="stylesheet" href="/css/style.css">
  

  
    
    <meta property="og:title" content="Day8_ElectronicAlbum"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://localhost:1313/day8_electronicalbum/"/>
    
    
  
</head>



<body class='page page-blog-single'>
  <div id="menu-main-mobile" class="menu-main-mobile">
    <ul class="menu">
        
        
            
                <li >
                    <a href="http://localhost:1313/">首页</a>
                </li>
            
        
            
                <li >
                    <a href="http://localhost:1313/posts/">博文</a>
                </li>
            
        
            
                <li >
                    <a href="https://sport.koobai.com/">骑行</a>
                </li>
            
        
            
                <li >
                    <a href="http://localhost:1313/apps/">软件</a>
                </li>
            
        
            
                <li >
                    <a href="http://localhost:1313/movies/">观影</a>
                </li>
            
        
            
                <li >
                    <a href="https://qiszy.taobao.com">好物</a>
                </li>
            
        
    </ul>
</div>
  <div id="wrapper" class="wrapper">
    <div class="header">

<div id="toggle-menu-main-mobile" class="hamburger-trigger">
  <button class="hamburger">Menu</button>
</div>
<div class="new-heard-menu">




<div class="header-menu">
  <a href="/" >首页</a>
</div>



<div class="header-menu">
  <a href="/posts/" >博文</a>
</div>



<div class="header-menu">
  <a href="https://sport.koobai.com/" >骑行</a>
</div>



<div class="header-menu">
  <a href="/apps/" >软件</a>
</div>



<div class="header-menu">
  <a href="/movies/" >观影</a>
</div>



<div class="header-menu">
  <a href="https://qiszy.taobao.com" target="_blank">好物</a>
</div>

</div>
  <div class="heard-right"> 
    <div class="about-koobai"><a href="/about/"><img src="https://img.koobai.com/koobai.webp" alt="koobai" title="我" data-umami-event="me"></a></div>
    <a href="https://github.com/koobai/blog" title="Github" target="_blank" class="githuab"><svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" data-view-component="true" ><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
    </svg></a>    
    <a href="https://space.bilibili.com/2084095738" target="_blank" title="当UP主的一天"><svg width="20" height="20" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="zhuzhan-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.73252 2.67094C3.33229 2.28484 3.33229 1.64373 3.73252 1.25764C4.11291 0.890684 4.71552 0.890684 5.09591 1.25764L7.21723 3.30403C7.27749 3.36218 7.32869 3.4261 7.37081 3.49407H10.5789C10.6211 3.4261 10.6723 3.36218 10.7325 3.30403L12.8538 1.25764C13.2342 0.890684 13.8368 0.890684 14.2172 1.25764C14.6175 1.64373 14.6175 2.28484 14.2172 2.67094L13.364 3.49407H14C16.2091 3.49407 18 5.28493 18 7.49407V12.9996C18 15.2087 16.2091 16.9996 14 16.9996H4C1.79086 16.9996 0 15.2087 0 12.9996V7.49406C0 5.28492 1.79086 3.49407 4 3.49407H4.58579L3.73252 2.67094ZM4 5.42343C2.89543 5.42343 2 6.31886 2 7.42343V13.0702C2 14.1748 2.89543 15.0702 4 15.0702H14C15.1046 15.0702 16 14.1748 16 13.0702V7.42343C16 6.31886 15.1046 5.42343 14 5.42343H4ZM5 9.31747C5 8.76519 5.44772 8.31747 6 8.31747C6.55228 8.31747 7 8.76519 7 9.31747V10.2115C7 10.7638 6.55228 11.2115 6 11.2115C5.44772 11.2115 5 10.7638 5 10.2115V9.31747ZM12 8.31747C11.4477 8.31747 11 8.76519 11 9.31747V10.2115C11 10.7638 11.4477 11.2115 12 11.2115C12.5523 11.2115 13 10.7638 13 10.2115V9.31747C13 8.76519 12.5523 8.31747 12 8.31747Z"></path></svg></a>
</div>

</div>

<script src="/js/moment.min.js?v=2.29.4"></script>
<script src="/js/moment.twitter.min.js"></script>
<script>
function formatDate(param) {
if(typeof param === 'number') {
     param = new Date(param * 1000).toISOString();
  }
return moment(Date.parse(param)).twitterLong().replace(/\s\d{2}:\d{2}/, '');
}
</script>
     
<div class="single-nrong">
<div class="single-zw">
    <div class="article_details">
      <div class="article_details_title">Day8_ElectronicAlbum</div>
      
    </div>
    <div class="content_zhengwen">
    <div class="content">
      <p>[TOC]</p>
<h1 id="实验要求">实验要求</h1>
<ol>
<li>分别实现5个按钮:上一张下一张,随机播放,循环播放,停止循环播放</li>
<li>在屏幕里选择一块区域显示图片,该区域同时也可以使用滑动.</li>
</ol>
<h1 id="代码实现">代码实现</h1>
<h2 id="lcdh">lcd.h</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifndef LCD_H
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LCD_H
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*函数声明*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="nf">Init_LCD</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Uninit_LCD</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Lcd_draw_point</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">color</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Lcd_draw_matrx</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">h</span><span class="p">,</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span><span class="kt">int</span> <span class="n">color</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Bmp_display</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">bmp_file</span><span class="p">,</span><span class="kt">int</span> <span class="n">x0</span><span class="p">,</span><span class="kt">int</span> <span class="n">y0</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span></code></pre></div><h2 id="lcdc">lcd.c</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/*头文件*/</span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*宏定义*/</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define FILE_PATH &#34;/dev/fb0&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">	Init_LCD:初始化显示屏
</span></span></span><span class="line"><span class="cl"><span class="cm">	参数为空
</span></span></span><span class="line"><span class="cl"><span class="cm">	返回值 int*
</span></span></span><span class="line"><span class="cl"><span class="cm">		成功 返回映射区域的首地址
</span></span></span><span class="line"><span class="cl"><span class="cm">		失败 返回NULL
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="nf">Init_LCD</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//1.打开帧缓冲
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="o">*</span><span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;/dev/fb0&#34;</span><span class="p">,</span><span class="n">O_RDWR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="o">*</span><span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nf">perror</span><span class="p">(</span><span class="s">&#34;open fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//2.映射
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span> <span class="o">=</span> <span class="nf">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">800</span><span class="o">*</span><span class="mi">480</span><span class="o">*</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl">			<span class="p">,</span><span class="n">PROT_READ</span> <span class="o">|</span>  <span class="n">PROT_WRITE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">MAP_SHARED</span><span class="p">,</span><span class="o">*</span><span class="n">fd</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">MAP_FAILED</span> <span class="o">==</span> <span class="n">plcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">perror</span><span class="p">(</span><span class="s">&#34;mmap fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">plcd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">	Uninit_LCD:解初始化屏幕
</span></span></span><span class="line"><span class="cl"><span class="cm">	@fd:帧缓冲的文件描述符
</span></span></span><span class="line"><span class="cl"><span class="cm">	@plcd:
</span></span></span><span class="line"><span class="cl"><span class="cm">	返回值:无
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Uninit_LCD</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//1.解映射
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">munmap</span><span class="p">(</span><span class="n">plcd</span><span class="p">,</span><span class="mi">800</span><span class="o">*</span><span class="mi">480</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//2.关闭帧缓冲
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Lcd_draw_point</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">color</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">plcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;error:plcd == NULL</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">800</span><span class="o">&amp;&amp;</span><span class="n">y</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">   		<span class="o">*</span><span class="p">(</span><span class="n">plcd</span><span class="o">+</span><span class="mi">800</span><span class="o">*</span><span class="n">y</span><span class="o">+</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Lcd_draw_matrx</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">h</span><span class="p">,</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span><span class="kt">int</span> <span class="n">color</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">||</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">880</span><span class="o">||</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">||</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">880</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">y</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nf">Lcd_draw_point</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">	Bmp_display:在屏幕的指定的位置显示bmp图片
</span></span></span><span class="line"><span class="cl"><span class="cm">	@bmp_file：图片的路径名
</span></span></span><span class="line"><span class="cl"><span class="cm">	@x0 y0 图片左上角在屏幕上的坐标
</span></span></span><span class="line"><span class="cl"><span class="cm">	@plcd:帧缓冲映射区域的首地址
</span></span></span><span class="line"><span class="cl"><span class="cm">	返回值：
</span></span></span><span class="line"><span class="cl"><span class="cm">		-1 失败
</span></span></span><span class="line"><span class="cl"><span class="cm">		0  成功
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Bmp_display</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">bmp_file</span><span class="p">,</span><span class="kt">int</span> <span class="n">x0</span><span class="p">,</span><span class="kt">int</span> <span class="n">y0</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">plcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">plcd</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">x0</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">x0</span><span class="o">&lt;</span><span class="mi">800</span><span class="o">&amp;&amp;</span><span class="n">y0</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">y0</span><span class="o">&lt;</span><span class="mi">480</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//1.打开图片
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">bmp_file</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span><span class="n">bmp_file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nf">perror</span><span class="p">(</span><span class="s">&#34;open fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//2.判断到底是不是一张bmp图片
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">	<span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mh">0x42</span> <span class="o">||</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mh">0x4D</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;NOT BMP</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//3.解析图片 宽 高 色深
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mh">0x16</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">short</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span> <span class="o">|</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">24</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">32</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;NOT SUPPORT!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s:%d*%d depth:%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">bmp_file</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">depth</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//4.获取像素数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">line_vaild_bytes</span><span class="o">=</span><span class="nf">abs</span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">*</span><span class="n">depth</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">line_bytes</span><span class="p">;</span><span class="c1">//一行总字节数=有效字节数+赖子数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">laizi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">line_vaild_bytes</span><span class="o">%</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">laizi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">line_vaild_bytes</span><span class="o">%</span><span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">line_bytes</span> <span class="o">=</span> <span class="n">line_vaild_bytes</span> <span class="o">+</span> <span class="n">laizi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">line_bytes</span><span class="o">*</span><span class="nf">abs</span><span class="p">(</span><span class="n">height</span><span class="p">);</span><span class="c1">//整个像素数组的大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//从文件中读取像素数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">piexl</span><span class="p">[</span><span class="n">total_bytes</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">piexl</span><span class="p">,</span><span class="n">total_bytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//5.在屏幕的对应位置显示即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">a</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//遍历整个像素数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">y</span><span class="o">&lt;</span><span class="nf">abs</span><span class="p">(</span><span class="n">height</span><span class="p">);</span><span class="n">y</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">  		<span class="k">for</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">x</span><span class="o">&lt;</span><span class="nf">abs</span><span class="p">(</span><span class="n">width</span><span class="p">);</span><span class="n">x</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">b</span><span class="o">=</span><span class="n">piexl</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="n">g</span><span class="o">=</span><span class="n">piexl</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="n">r</span><span class="o">=</span><span class="n">piexl</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    		<span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">==</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">a</span><span class="o">=</span><span class="n">piexl</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">    		<span class="k">else</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//不透明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">}</span>
</span></span><span class="line"><span class="cl">    		<span class="n">color</span><span class="o">=</span><span class="n">a</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="o">|</span><span class="n">r</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="o">|</span><span class="n">g</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    		<span class="nf">Lcd_draw_point</span><span class="p">(</span><span class="n">width</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="n">x</span><span class="o">+</span><span class="nl">x0</span><span class="p">:</span><span class="n">x0</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          	<span class="n">height</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="n">y0</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">y0</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">  		<span class="c1">//每一行末尾可能存在赖子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  		<span class="n">i</span><span class="o">+=</span><span class="n">laizi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="touchh">touch.h</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifndef __TOUCH_H__
</span></span></span><span class="line"><span class="cl"><span class="cp">#define __TOUCH_H__
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*头文件*/</span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/input.h&gt;//输入子系统</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define UP 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define DOWN 2
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LEFT 3
</span></span></span><span class="line"><span class="cl"><span class="cp">#define RIGHT 4
</span></span></span><span class="line"><span class="cl"><span class="cp">#define TOUCH_ERROR -1
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*宏定义*/</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define TOUCH_FILE &#34;/dev/input/event0&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Init_touch</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span>  <span class="nf">Uninit_touch</span><span class="p">(</span><span class="kt">int</span> <span class="n">touch_fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">get_usr_input_pro</span><span class="p">(</span><span class="kt">int</span> <span class="n">touch_fd</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">x1</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y1</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">x2</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Get_slip_direction</span><span class="p">(</span><span class="kt">int</span> <span class="n">x1</span><span class="p">,</span><span class="kt">int</span> <span class="n">y1</span><span class="p">,</span><span class="kt">int</span> <span class="n">x2</span> <span class="p">,</span><span class="kt">int</span> <span class="n">y2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">get_touch</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    get_usr_touch: 获取用户触摸屏输入的坐标值
</span></span></span><span class="line"><span class="cl"><span class="cm">    @x ：保存 x轴的坐标值
</span></span></span><span class="line"><span class="cl"><span class="cm">    @y ：保存 y轴的坐标值
</span></span></span><span class="line"><span class="cl"><span class="cm">        返回值 ：
</span></span></span><span class="line"><span class="cl"><span class="cm">            无
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">get_usr_touch</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    功能 : 获取方向返回
</span></span></span><span class="line"><span class="cl"><span class="cm">        返回值 :
</span></span></span><span class="line"><span class="cl"><span class="cm">        -1 失败
</span></span></span><span class="line"><span class="cl"><span class="cm">        UP 1
</span></span></span><span class="line"><span class="cl"><span class="cm">        DOWN 2
</span></span></span><span class="line"><span class="cl"><span class="cm">        LEFT 3
</span></span></span><span class="line"><span class="cl"><span class="cm">        RIGHT 4
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">getway</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span></code></pre></div><h2 id="touchc">touch.c</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;touch.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    触摸屏初始化:Init_touch
</span></span></span><span class="line"><span class="cl"><span class="cm">    参数为空
</span></span></span><span class="line"><span class="cl"><span class="cm">    返回值：int
</span></span></span><span class="line"><span class="cl"><span class="cm">        touch_fd:触摸屏的文件描述符
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Init_touch</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//1.打开触摸屏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">touch_fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">TOUCH_FILE</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">touch_fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;open touch fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">touch_fd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    关闭触摸屏：Uninit_touch
</span></span></span><span class="line"><span class="cl"><span class="cm">    @touch_fd
</span></span></span><span class="line"><span class="cl"><span class="cm">    返回值:void
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span>  <span class="nf">Uninit_touch</span><span class="p">(</span><span class="kt">int</span> <span class="n">touch_fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">touch_fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">close</span><span class="p">(</span><span class="n">touch_fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    get_usr_input_pro:获取用户的对触摸屏的输入
</span></span></span><span class="line"><span class="cl"><span class="cm">    @x1 y1 
</span></span></span><span class="line"><span class="cl"><span class="cm">    @x2 y2
</span></span></span><span class="line"><span class="cl"><span class="cm">    @touch_fd
</span></span></span><span class="line"><span class="cl"><span class="cm">    返回值:int 
</span></span></span><span class="line"><span class="cl"><span class="cm">        -1  失败
</span></span></span><span class="line"><span class="cl"><span class="cm">        0   成功
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span>  <span class="nf">get_usr_input_pro</span><span class="p">(</span><span class="kt">int</span> <span class="n">touch_fd</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">x1</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y1</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">x2</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">touch_fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">input_event</span> <span class="n">ev</span><span class="p">;</span><span class="c1">//保存读取出来的信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">x1</span> <span class="o">=</span> <span class="o">*</span><span class="n">y1</span> <span class="o">=</span> <span class="o">*</span><span class="n">x2</span> <span class="o">=*</span><span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//1 读取输入事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">touch_fd</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">))</span> <span class="c1">// 判断结构体数据不符合要求 重新读
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span><span class="c1">//跳过本次循环,执行下一次循环
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//2.2 通过判断结构体里面的成员坐标值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ABS_X</span><span class="p">)</span> <span class="c1">//获取x轴的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="o">*</span><span class="n">x1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">*</span><span class="n">x1</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>  <span class="c1">//只获取一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">*</span><span class="n">x2</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="n">x2</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>         
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ABS_Y</span><span class="p">)</span> <span class="c1">//获取x轴的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="o">*</span><span class="n">y1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">*</span><span class="n">y1</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>  <span class="c1">//只获取一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">*</span><span class="n">y2</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="n">y2</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">           
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_KEY</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">BTN_TOUCH</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="c1">//手指松开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span><span class="c1">//一次获取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*  
</span></span></span><span class="line"><span class="cl"><span class="cm">    获取滑动的方向:Get_slip_direction
</span></span></span><span class="line"><span class="cl"><span class="cm">    @x1 y1 
</span></span></span><span class="line"><span class="cl"><span class="cm">    @x2 y2
</span></span></span><span class="line"><span class="cl"><span class="cm">    返回值：int
</span></span></span><span class="line"><span class="cl"><span class="cm">        LEFT RIGHT UP DOWN TOUCH_ERROR
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Get_slip_direction</span><span class="p">(</span><span class="kt">int</span> <span class="n">x1</span><span class="p">,</span><span class="kt">int</span> <span class="n">y1</span><span class="p">,</span><span class="kt">int</span> <span class="n">x2</span> <span class="p">,</span><span class="kt">int</span> <span class="n">y2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">x1</span> <span class="o">||</span> <span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">y1</span> <span class="o">||</span> <span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">x2</span> <span class="o">||</span> <span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">y2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">TOUCH_ERROR</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">direction</span><span class="p">;</span> <span class="c1">//方向
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nf">abs</span><span class="p">((</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//上 或者 下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;</span> <span class="n">y1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">DOWN</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">UP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">x2</span> <span class="o">&gt;</span> <span class="n">x1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">RIGHT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">LEFT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//打印坐标  测试
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">get_touch</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//1.打开触摸屏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;/dev/input/event0&#34;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;open touch fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//2.操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">input_event</span> <span class="n">ev</span><span class="p">;</span><span class="c1">//保存读取出来的信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;type =%d,code=%d,value=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span><span class="p">,</span><span class="n">ev</span><span class="p">.</span><span class="n">code</span><span class="p">,</span><span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">x</span> <span class="p">,</span><span class="n">y</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ABS_X</span> <span class="p">)</span><span class="c1">//触摸屏的x轴
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span> <span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="mi">800</span><span class="o">/</span><span class="mi">1040</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ABS_Y</span> <span class="p">)</span><span class="c1">//触摸屏的y轴
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="mi">480</span><span class="o">/</span><span class="mi">600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;( %d , %d )</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_KEY</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">BTN_TOUCH</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="c1">//手指松开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span><span class="c1">//一次获取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//3.关闭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    get_usr_touch: 获取用户触摸屏输入的坐标值
</span></span></span><span class="line"><span class="cl"><span class="cm">    @x ：保存 x轴的坐标值
</span></span></span><span class="line"><span class="cl"><span class="cm">    @y ：保存 y轴的坐标值
</span></span></span><span class="line"><span class="cl"><span class="cm">        返回值 ：
</span></span></span><span class="line"><span class="cl"><span class="cm">            无
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">get_usr_touch</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//1.打开触摸屏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;/dev/input/event0&#34;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;open touch fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//2.操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">input_event</span> <span class="n">ev</span><span class="p">;</span><span class="c1">//保存读取出来的信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">        <span class="c1">//2.1 读取输入事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">flag_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">flag_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">))</span> <span class="c1">// 判断结构体数据不符合要求 重新读
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span><span class="c1">//跳过本次循环,执行下一次循环
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//2.2 通过判断结构体里面的成员获取坐标值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ABS_X</span><span class="p">)</span> <span class="c1">//获取x轴的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="mi">800</span><span class="o">/</span><span class="mi">1040</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag_x</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">flag_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ABS_Y</span><span class="p">)</span> <span class="c1">//获取y轴的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="mi">480</span><span class="o">/</span><span class="mi">600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag_y</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">flag_x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_KEY</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">BTN_TOUCH</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="c1">//手指松开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span><span class="c1">//一次获取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//3.关闭触摸屏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    功能 : 获取方向返回
</span></span></span><span class="line"><span class="cl"><span class="cm">        返回值 :
</span></span></span><span class="line"><span class="cl"><span class="cm">        -1 失败
</span></span></span><span class="line"><span class="cl"><span class="cm">        UP 1
</span></span></span><span class="line"><span class="cl"><span class="cm">        DOWN 2
</span></span></span><span class="line"><span class="cl"><span class="cm">        LEFT 3
</span></span></span><span class="line"><span class="cl"><span class="cm">        RIGHT 4
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">getway</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//1.打开触摸屏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;/dev/input/event0&#34;</span><span class="p">,</span><span class="n">O_RDWR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;open touch fail&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//2.操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">input_event</span> <span class="n">ev</span><span class="p">;</span><span class="c1">//保存读取出来的信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">;</span><span class="c1">//初始坐标,把自身作为判断
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">x1</span> <span class="p">,</span><span class="n">y1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//2.1 读取输入事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">))</span> <span class="c1">// 判断结构体数据不符合要求 重新读
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span><span class="c1">//跳过本次循环,执行下一次循环
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//2.2 通过判断结构体里面的成员坐标值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">REL_X</span><span class="p">)</span> <span class="c1">//获取x轴的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">x0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">x0</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>  <span class="c1">//只获取一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">x1</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">           
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">REL_Y</span><span class="p">)</span> <span class="c1">//获取x轴的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">y0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">y0</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>  <span class="c1">//只获取一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">y1</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">           
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_KEY</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">BTN_TOUCH</span> <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="c1">//手指松开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span><span class="c1">//一次获取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;start ( %d , %d ) , leave ( %d , %d )</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">way</span><span class="p">;</span> <span class="c1">//方向
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nf">abs</span><span class="p">((</span><span class="n">y1</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//上 或者 下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">y1</span> <span class="o">&gt;</span> <span class="n">y0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;DOWN</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">way</span> <span class="o">=</span> <span class="n">DOWN</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;UP</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">way</span> <span class="o">=</span> <span class="n">UP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="n">x0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;RIGHT</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">way</span> <span class="o">=</span> <span class="n">RIGHT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;LEFT</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">way</span> <span class="o">=</span> <span class="n">LEFT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">way</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="mainc">main.c</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;touch.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;lcd.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">touch_fd</span> <span class="o">=</span> <span class="nf">Init_touch</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">fd</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span><span class="o">*</span> <span class="n">plcd</span> <span class="o">=</span> <span class="nf">Init_LCD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//int x,y;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// for(y=0;y&gt;=10&amp;&amp;y&lt;420;y++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 	for(x=0;x&lt;=790&amp;&amp;x&gt;=10;x++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 	{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 		Lcd_draw_point(x,y,0x000000,plcd);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/shang.bmp&#34;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/xiay.bmp&#34;</span><span class="p">,</span><span class="mi">174</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/sui.bmp&#34;</span><span class="p">,</span><span class="mi">328</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/xun.bmp&#34;</span><span class="p">,</span><span class="mi">482</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/ting.bmp&#34;</span><span class="p">,</span><span class="mi">636</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="o">*</span><span class="n">file_name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;./bmp/1.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/2.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/3.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/4.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/5.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/6.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/7.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/8.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/9.bmp&#34;</span><span class="p">,</span><span class="s">&#34;./bmp/10.bmp&#34;</span><span class="p">};</span>	<span class="c1">//存放图片地址和名字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">x1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">y1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">x2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">y2</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//存放图片顺序
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span> <span class="c1">//存放坐标值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">get_usr_touch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//显示区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">790</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;=</span> <span class="mi">410</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//测试滑动			
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="nf">get_usr_input_pro</span><span class="p">(</span><span class="n">touch_fd</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">y1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x2</span><span class="p">,</span><span class="o">&amp;</span><span class="n">y2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">direction</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">switch</span> <span class="p">(</span><span class="n">direction</span> <span class="o">=</span> <span class="nf">Get_slip_direction</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">UP</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;UP</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span><span class="mi">9</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">DOWN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;DOWN</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">--</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">RIGHT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;RIGHT</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">--</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>					
</span></span><span class="line"><span class="cl">					<span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">LEFT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;LEFT</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span><span class="mi">9</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>					
</span></span><span class="line"><span class="cl">					<span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">				<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">					<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        	<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//上一张
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">20</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">164</span>  <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">420</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;=</span> <span class="mi">470</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/shang1.bmp&#34;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="nf">usleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="nf">Bmp_display</span><span class="p">(</span><span class="s">&#34;./bmp/shang.bmp&#34;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;return</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">--</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//下一张
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">174</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">318</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">420</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;=</span> <span class="mi">470</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span><span class="p">(</span><span class="mi">9</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;next</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//随机播放
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">328</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">472</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">420</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;=</span> <span class="mi">470</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">i</span> <span class="o">=</span> <span class="nf">random</span><span class="p">()</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//循环播放
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">482</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">626</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">420</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;=</span> <span class="mi">470</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span><span class="p">(</span><span class="mi">9</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nf">Bmp_display</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">],</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="nf">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//停止循环播放
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">420</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">636</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">470</span><span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;=</span><span class="mi">780</span>  <span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;停止循环播放&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Uninit_touch</span><span class="p">(</span><span class="n">touch_fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Uninit_LCD</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">plcd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>
    </div>
    <div class="single-biaoq">
 <div class="page-time">更新于 
  <script>
    document.write(formatDate( 1759488826 )); 
  </script>
 </div>
 <div class="single-tag">
     
          
     <div class="single-tag-c">#<a href="/tags/default_tag/">Default_tag</a></div>
          
          
 </div>
  </div> 
 </div>
 
 <div class="archives_nrong" >
  
    <div class="archives_one">
      <div>
        <div class="archive-title"><a href="/day9_pthread/">Day9_pthread</a></div>
        <div class="archive-time">
          <script>
            document.write(formatDate( 1759488826 )); 
          </script>
        </div>
        </div>
        <div class="archive-img">
        <a href="/day9_pthread/"><img loading="lazy" decoding="async" src="/" /></a>          
        </div>
    </div>
  
  
    <div class="archives_one">
      <div>
        <div class="archive-title"><a href="/day7_sliptouch/">Day7_SlipTouch</a></div>
        <div class="archive-time">
          <script>
            document.write(formatDate( 1759488826 )); 
          </script>
        </div>
        </div>
        <div class="archive-img">
        <a href="/day7_sliptouch/"><img loading="lazy" decoding="async" src="/" /></a>          
        </div>
    </div>
  
</div>
      
      <div id="MoreComments" onclick="loadComments()">评论一下 ...</div>
      <div class="article-comments" id="articlecomments" style="display: none;"><link href="https://img.koobai.com/Artalk.css" rel="stylesheet">
<script src="https://img.koobai.com/Artalk.js"></script>


<div id="Comments"></div>

<script>
  Artalk.init({
    el:        '#Comments',
    pageKey:   'http:\/\/localhost:1313\/day8_electronicalbum\/',
    pageTitle: 'Day8_ElectronicAlbum',
    server:    'https:\/\/c.koobai.com',
    site:      'Koobai 空白生活',
    
  })
</script></div> 
</div>

<div>
    <div class="paragraph-dh">
     <nav id="TableOfContents">
  <ul>
    <li><a href="#lcdh">lcd.h</a></li>
    <li><a href="#lcdc">lcd.c</a></li>
    <li><a href="#touchh">touch.h</a></li>
    <li><a href="#touchc">touch.c</a></li>
    <li><a href="#mainc">main.c</a></li>
  </ul>
</nav>
    </div>
</div>

</div>
<script src="/js/single.js"></script>    

  </div>
  <div class="footer-background">
<div class="footer">
        <div class="footer-info">&copy; 2025 <a href="/">空白Koobai</a>. 
        由 <a href="https://gohugo.io/" target="_blank"> Hugo </a> 提供强力驱动,<span class="youpaiyun"><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">又拍云</a>提供存储/加速</span>. 
        <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备16011784号-1</a> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011302000343">浙公网安备 33011302000343 号</a>
      </div>
      <div class="footer-rss">
      <a href="https://memos.koobai.com/u/1/rss.xml" target="_blank">唠叨 RSS</a> / 
      <a href="https://koobai.com/index.xml" target="_blank">博文 RSS</a>
      </div>
    </div>
  </div>
 
 <script src="/js/view-image.min.js"></script>
  
<div class="gotop_hide">
  <div class="gotop" onclick="smoothScrollTop()" id="gotop"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 2048"><path d="m1875 1037l-787-787v1798H960V250l-787 787l-90-90L1024 6l941 941z"/></svg></div>
</div>
  

  

  
  <script type="text/javascript" src="/js/bundle.js"></script>
  

  
   
</body>
</html>
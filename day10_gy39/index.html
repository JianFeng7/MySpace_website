<!DOCTYPE html>
<html lang="zh-CN">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Day10_GY39 - 空白Koobai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="/suju/ios.json">
  <link rel="icon" href="https://img.koobai.com/koobai.png">
  <link href="/index.xml" title="空白Koobai" type="application/rss+xml">
  <link rel="canonical" href="http://localhost:1313/day10_gy39/" />

  
  
  <link rel="stylesheet" href="/css/style.css">
  

  
    
    <meta property="og:title" content="Day10_GY39"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://localhost:1313/day10_gy39/"/>
    
    
  
</head>



<body class='page page-blog-single'>
  <div id="menu-main-mobile" class="menu-main-mobile">
    <ul class="menu">
        
        
            
                <li >
                    <a href="http://localhost:1313/">首页</a>
                </li>
            
        
            
                <li >
                    <a href="http://localhost:1313/posts/">博文</a>
                </li>
            
        
            
                <li >
                    <a href="https://sport.koobai.com/">骑行</a>
                </li>
            
        
            
                <li >
                    <a href="http://localhost:1313/apps/">软件</a>
                </li>
            
        
            
                <li >
                    <a href="http://localhost:1313/movies/">观影</a>
                </li>
            
        
            
                <li >
                    <a href="https://qiszy.taobao.com">好物</a>
                </li>
            
        
    </ul>
</div>
  <div id="wrapper" class="wrapper">
    <div class="header">

<div id="toggle-menu-main-mobile" class="hamburger-trigger">
  <button class="hamburger">Menu</button>
</div>
<div class="new-heard-menu">




<div class="header-menu">
  <a href="/" >首页</a>
</div>



<div class="header-menu">
  <a href="/posts/" >博文</a>
</div>



<div class="header-menu">
  <a href="https://sport.koobai.com/" >骑行</a>
</div>



<div class="header-menu">
  <a href="/apps/" >软件</a>
</div>



<div class="header-menu">
  <a href="/movies/" >观影</a>
</div>



<div class="header-menu">
  <a href="https://qiszy.taobao.com" target="_blank">好物</a>
</div>

</div>
  <div class="heard-right"> 
    <div class="about-koobai"><a href="/about/"><img src="https://img.koobai.com/koobai.webp" alt="koobai" title="我" data-umami-event="me"></a></div>
    <a href="https://github.com/koobai/blog" title="Github" target="_blank" class="githuab"><svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" data-view-component="true" ><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
    </svg></a>    
    <a href="https://space.bilibili.com/2084095738" target="_blank" title="当UP主的一天"><svg width="20" height="20" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="zhuzhan-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.73252 2.67094C3.33229 2.28484 3.33229 1.64373 3.73252 1.25764C4.11291 0.890684 4.71552 0.890684 5.09591 1.25764L7.21723 3.30403C7.27749 3.36218 7.32869 3.4261 7.37081 3.49407H10.5789C10.6211 3.4261 10.6723 3.36218 10.7325 3.30403L12.8538 1.25764C13.2342 0.890684 13.8368 0.890684 14.2172 1.25764C14.6175 1.64373 14.6175 2.28484 14.2172 2.67094L13.364 3.49407H14C16.2091 3.49407 18 5.28493 18 7.49407V12.9996C18 15.2087 16.2091 16.9996 14 16.9996H4C1.79086 16.9996 0 15.2087 0 12.9996V7.49406C0 5.28492 1.79086 3.49407 4 3.49407H4.58579L3.73252 2.67094ZM4 5.42343C2.89543 5.42343 2 6.31886 2 7.42343V13.0702C2 14.1748 2.89543 15.0702 4 15.0702H14C15.1046 15.0702 16 14.1748 16 13.0702V7.42343C16 6.31886 15.1046 5.42343 14 5.42343H4ZM5 9.31747C5 8.76519 5.44772 8.31747 6 8.31747C6.55228 8.31747 7 8.76519 7 9.31747V10.2115C7 10.7638 6.55228 11.2115 6 11.2115C5.44772 11.2115 5 10.7638 5 10.2115V9.31747ZM12 8.31747C11.4477 8.31747 11 8.76519 11 9.31747V10.2115C11 10.7638 11.4477 11.2115 12 11.2115C12.5523 11.2115 13 10.7638 13 10.2115V9.31747C13 8.76519 12.5523 8.31747 12 8.31747Z"></path></svg></a>
</div>

</div>

<script src="/js/moment.min.js?v=2.29.4"></script>
<script src="/js/moment.twitter.min.js"></script>
<script>
function formatDate(param) {
if(typeof param === 'number') {
     param = new Date(param * 1000).toISOString();
  }
return moment(Date.parse(param)).twitterLong().replace(/\s\d{2}:\d{2}/, '');
}
</script>
     
<div class="single-nrong">
<div class="single-zw">
    <div class="article_details">
      <div class="article_details_title">Day10_GY39</div>
      
    </div>
    <div class="content_zhengwen">
    <div class="content">
      <p>[TOC]</p>
<h1 id="1-6818串口初始函数">1. 6818串口初始函数</h1>
<p>6818右上角，有4个串口，分别是<code>COM2 COM3 COM4 COM 5</code></p>
<p><code>VCC TX RX GND</code></p>
<p><code>GY39</code>模块</p>
<p><code>VCC  TX  RX GND</code></p>
<p><code> TX --- RX  RX---TX</code></p>
<p><strong>注意电源千万别接反了!</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">LINUX下一切皆文件。串口在LINUX中也是以文件的形式存在的。串口发送给数据就是往文件中写数据，串口接收就是从文件读取数据。
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;termios.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;netdb.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">//6818串口所对应的文件名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define COM2 &#34;/dev/ttySAC1&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define COM3 &#34;/dev/ttySAC2&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define COM4 &#34;/dev/ttySAC3&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="cm">/* 设置串口参数（初始化串口） */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">init_tty</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>    
</span></span><span class="line"><span class="cl">	<span class="c1">//声明设置串口的结构体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">struct</span> <span class="n">termios</span> <span class="n">termios_new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//先清空该结构体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">bzero</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">termios_new</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">termios_new</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	cfmakeraw()设置终端属性，就是设置termios结构中的各个参数。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">cfmakeraw</span><span class="p">(</span><span class="o">&amp;</span><span class="n">termios_new</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//设置波特率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//termios_new.c_cflag=(B9600);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">cfsetispeed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">termios_new</span><span class="p">,</span> <span class="n">B9600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">cfsetospeed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">termios_new</span><span class="p">,</span> <span class="n">B9600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//CLOCAL和CREAD分别用于本地连接和接受使能，因此，首先要通过位掩码的方式激活这两个选项。    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cflag</span> <span class="o">|=</span> <span class="n">CLOCAL</span> <span class="o">|</span> <span class="n">CREAD</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//通过掩码设置数据位为8位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cflag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CSIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cflag</span> <span class="o">|=</span> <span class="n">CS8</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="c1">//设置无奇偶校验
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cflag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PARENB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//一位停止位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cflag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CSTOPB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="nf">tcflush</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">TCIFLUSH</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 可设置接收字符和等待时间，无特殊要求可以将其设置为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VTIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">termios_new</span><span class="p">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VMIN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 用于清空输入/输出缓冲区
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="nf">tcflush</span> <span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">TCIFLUSH</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//完成配置后，可以使用以下函数激活串口设置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="nf">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">TCSANOW</span><span class="p">,</span><span class="o">&amp;</span><span class="n">termios_new</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Setting the serial1 failed!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="2gy39传感器模块">2.GY39传感器模块</h1>
<p>GY-39 可以测量:气压，温湿度，光强度传感器模块。</p>
<p><img src="../BLOGS_img/image-20220528202432066.png" alt="image-20220528202432066" class="img-hide" loading="lazy" decoding="async" /></p>
<p>引脚以及功能:</p>
<p><img src="https://typora-imag.oss-cn-hangzhou.aliyuncs.com/image-20220528202445272.png" alt="image-20220528202445272" class="img-hide" loading="lazy" decoding="async" /></p>
<p><img src="../../BLOGS_img/image-20220528202533714.png" alt="image-20220528202533714" class="img-hide" loading="lazy" decoding="async" /></p>
<blockquote>
<p>在串口协议下,每个帧包含了8-13个字节的内容。</p>
<p>其中前两个字节都为5A，为帧头标志，第三个字节表示数据类型。</p>
<p><img src="../../BLOGS_img/image-20220528202838871.png" alt="image-20220528202838871" class="img-hide" loading="lazy" decoding="async" /></p>
<p>其他为数据位，最后一个是校验和。</p>
<p><img src="../../BLOGS_img/image-20220528202936000.png" alt="image-20220528202936000" class="img-hide" loading="lazy" decoding="async" /></p>
<p><img src="../../BLOGS_img/image-20220528202949160.png" alt="image-20220528202949160" class="img-hide" loading="lazy" decoding="async" /></p></blockquote>
<p>例如：</p>
<p><img src="../../BLOGS_img/image-20220528203012654.png" alt="image-20220528203012654" class="img-hide" loading="lazy" decoding="async" /></p>

    </div>
    <div class="single-biaoq">
 <div class="page-time">更新于 
  <script>
    document.write(formatDate( 1759488826 )); 
  </script>
 </div>
 <div class="single-tag">
     
          
     <div class="single-tag-c">#<a href="/tags/default_tag/">Default_tag</a></div>
          
          
 </div>
  </div> 
 </div>
 
 <div class="archives_nrong" >
  
    <div class="archives_one">
      <div>
        <div class="archive-title"><a href="/day11_madplaymakefile/">Day11_madplay&amp;makefile</a></div>
        <div class="archive-time">
          <script>
            document.write(formatDate( 1759488826 )); 
          </script>
        </div>
        </div>
        <div class="archive-img">
        <a href="/day11_madplaymakefile/"><img loading="lazy" decoding="async" src="/" /></a>          
        </div>
    </div>
  
  
    <div class="archives_one">
      <div>
        <div class="archive-title"><a href="/day1_flow/">Day1_flow</a></div>
        <div class="archive-time">
          <script>
            document.write(formatDate( 1759488826 )); 
          </script>
        </div>
        </div>
        <div class="archive-img">
        <a href="/day1_flow/"><img loading="lazy" decoding="async" src="/" /></a>          
        </div>
    </div>
  
</div>
      
      <div id="MoreComments" onclick="loadComments()">评论一下 ...</div>
      <div class="article-comments" id="articlecomments" style="display: none;"><link href="https://img.koobai.com/Artalk.css" rel="stylesheet">
<script src="https://img.koobai.com/Artalk.js"></script>


<div id="Comments"></div>

<script>
  Artalk.init({
    el:        '#Comments',
    pageKey:   'http:\/\/localhost:1313\/day10_gy39\/',
    pageTitle: 'Day10_GY39',
    server:    'https:\/\/c.koobai.com',
    site:      'Koobai 空白生活',
    
  })
</script></div> 
</div>

<div>
    <div class="paragraph-dh">
     <nav id="TableOfContents"></nav>
    </div>
</div>

</div>
<script src="/js/single.js"></script>    

  </div>
  <div class="footer-background">
<div class="footer">
        <div class="footer-info">&copy; 2025 <a href="/">空白Koobai</a>. 
        由 <a href="https://gohugo.io/" target="_blank"> Hugo </a> 提供强力驱动,<span class="youpaiyun"><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">又拍云</a>提供存储/加速</span>. 
        <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备16011784号-1</a> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011302000343">浙公网安备 33011302000343 号</a>
      </div>
      <div class="footer-rss">
      <a href="https://memos.koobai.com/u/1/rss.xml" target="_blank">唠叨 RSS</a> / 
      <a href="https://koobai.com/index.xml" target="_blank">博文 RSS</a>
      </div>
    </div>
  </div>
 
 <script src="/js/view-image.min.js"></script>
  
<div class="gotop_hide">
  <div class="gotop" onclick="smoothScrollTop()" id="gotop"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 2048"><path d="m1875 1037l-787-787v1798H960V250l-787 787l-90-90L1024 6l941 941z"/></svg></div>
</div>
  

  

  
  <script type="text/javascript" src="/js/bundle.js"></script>
  

  
   
</body>
</html>